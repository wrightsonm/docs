<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Documentation (Wiki) for Tasmota"><link href=https://tasmota.github.io/docs/Bluetooth_ESP32/ rel=canonical><link rel=icon href=../_media/favicon.ico><meta name=generator content="mkdocs-1.2.3, mkdocs-material-7.3.4"><title>Bluetooth Low Energy - Tasmota</title><link rel=stylesheet href=../assets/stylesheets/main.db9e7362.min.css><link rel=stylesheet href=../assets/stylesheets/palette.3f5d1f46.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Barlow:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Barlow";--md-code-font-family:"Roboto Mono"}</style><link rel=stylesheet href=../assets/css/anchor-fix.css><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-140681905-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=indigo> <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script> <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#mi32-sensors class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title=Tasmota class="md-header__button md-logo" aria-label=Tasmota data-md-component=logo> <img src=../_media/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Tasmota </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Bluetooth Low Energy </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=deep-purple aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/arendst/tasmota/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> arendst/tasmota </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../Features/ class=md-tabs__link> Features </a> </li> <li class=md-tabs__item> <a href=../ESP32/ class="md-tabs__link md-tabs__link--active"> ESP32 </a> </li> <li class=md-tabs__item> <a href=../Integrations/ class=md-tabs__link> Smart Home Integrations </a> </li> <li class=md-tabs__item> <a href=../Supported-Peripherals/ class=md-tabs__link> Peripherals </a> </li> <li class=md-tabs__item> <a href=../Configuration-Procedure-for-New-Devices/ class=md-tabs__link> Supported Devices </a> </li> <li class=md-tabs__item> <a href=../FAQ/ class=md-tabs__link> Help </a> </li> <li class=md-tabs__item> <a href=../Firmware-Builds/ class=md-tabs__link> Firmware Builds </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title=Tasmota class="md-nav__button md-logo" aria-label=Tasmota data-md-component=logo> <img src=../_media/logo.svg alt=logo> </a> Tasmota </label> <div class=md-nav__source> <a href=https://github.com/arendst/tasmota/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> arendst/tasmota </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> Home <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Home data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> News </a> </li> <li class=md-nav__item> <a href=../About/ class=md-nav__link> About </a> </li> <li class=md-nav__item> <a href=../Getting-Started/ class=md-nav__link> Getting Started </a> </li> <li class=md-nav__item> <a href=../Upgrading/ class=md-nav__link> Upgrading </a> </li> <li class=md-nav__item> <a href=../MQTT/ class=md-nav__link> MQTT </a> </li> <li class=md-nav__item> <a href=../Commands/ class=md-nav__link> Commands </a> </li> <li class=md-nav__item> <a href=../Templates/ class=md-nav__link> Templates </a> </li> <li class=md-nav__item> <a href=../Components/ class=md-nav__link> Components </a> </li> <li class=md-nav__item> <a href=../Modules/ class=md-nav__link> Modules </a> </li> <li class=md-nav__item> <a href=../Peripherals/ class=md-nav__link> Peripherals </a> </li> <li class=md-nav__item> <a href=../WebUI/ class=md-nav__link> WebUI </a> </li> <li class=md-nav__item> <a href=../Compile-your-build/ class=md-nav__link> Compiling </a> </li> <li class=md-nav__item> <a href=../Contributing/ class=md-nav__link> Contributing </a> </li> <li class=md-nav__item> <a href=../Download/ class=md-nav__link> Download </a> </li> <li class=md-nav__item> <a href=https://github.com/arendst/Tasmota/discussions/categories/show-and-tell class=md-nav__link> Project Showcase </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Features <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Features data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Features </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Features/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../ADC/ class=md-nav__link> Analog pin </a> </li> <li class=md-nav__item> <a href=../Bluetooth/ class=md-nav__link> Bluetooth </a> </li> <li class=md-nav__item> <a href=../Buttons-and-Switches/ class=md-nav__link> Buttons and Switches </a> </li> <li class=md-nav__item> <a href=../DeepSleep/ class=md-nav__link> DeepSleep </a> </li> <li class=md-nav__item> <a href=../Device-Groups/ class=md-nav__link> Device Groups </a> </li> <li class=md-nav__item> <a href=../Displays/ class=md-nav__link> Displays </a> </li> <li class=md-nav__item> <a href=../Dynamic-Sleep/ class=md-nav__link> Dynamic Sleep </a> </li> <li class=md-nav__item> <a href=../I2CDevices/ class=md-nav__link> I2C Devices </a> </li> <li class=md-nav__item> <a href=../Tasmota-IR/ class=md-nav__link> IR Communication </a> </li> <li class=md-nav__item> <a href=../Projector/ class=md-nav__link> LCD/DLP Projector Control </a> </li> <li class=md-nav__item> <a href=../Lights/ class=md-nav__link> Lights </a> </li> <li class=md-nav__item> <a href=../OpenTherm/ class=md-nav__link> OpenTherm </a> </li> <li class=md-nav__item> <a href=../PIR-Motion-Sensors/ class=md-nav__link> PIR Motion Sensors </a> </li> <li class=md-nav__item> <a href=../Power-Monitoring-Calibration/ class=md-nav__link> Power Monitoring Calibration </a> </li> <li class=md-nav__item> <a href=../PWM-dimmer-switch/ class=md-nav__link> PWM Dimmer </a> </li> <li class=md-nav__item> <a href=../RF-Protocol/ class=md-nav__link> RF Communication </a> </li> <li class=md-nav__item> <a href=../Rules/ class=md-nav__link> Rules </a> </li> <li class=md-nav__item> <a href=../Scripting-Language/ class=md-nav__link> Scripting </a> </li> <li class=md-nav__item> <a href=../Serial-to-TCP-Bridge/ class=md-nav__link> Serial to TCP Bridge </a> </li> <li class=md-nav__item> <a href=../Blinds-and-Shutters/ class=md-nav__link> Shutters and Blinds </a> </li> <li class=md-nav__item> <a href=../Range-Extender/ class=md-nav__link> Range Extender </a> </li> <li class=md-nav__item> <a href=../Smart-Meter-Interface/ class=md-nav__link> Smart Meter Interface </a> </li> <li class=md-nav__item> <a href=../Subscribe-%26-Unsubscribe/ class=md-nav__link> Subscribe & Unsubscribe </a> </li> <li class=md-nav__item> <a href=../TasmotaClient/ class=md-nav__link> TasmotaClient </a> </li> <li class=md-nav__item> <a href=../Thermostat/ class=md-nav__link> Thermostat </a> </li> <li class=md-nav__item> <a href=../Timers/ class=md-nav__link> Timers </a> </li> <li class=md-nav__item> <a href=../TLS/ class=md-nav__link> TLS Secured MQTT </a> </li> <li class=md-nav__item> <a href=../TuyaMCU/ class=md-nav__link> TuyaMCU </a> </li> <li class=md-nav__item> <a href=../UFS/ class=md-nav__link> Universal File System </a> </li> <li class=md-nav__item> <a href=../Zigbee/ class=md-nav__link> Zigbee </a> </li> <li class=md-nav__item> <a href=../Tutorials/ class=md-nav__link> Projects and Tutorials </a> </li> <li class=md-nav__item> <a href=../For-Developers/ class=md-nav__link> For Developers </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3> ESP32 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=ESP32 data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> ESP32 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ESP32/ class=md-nav__link> Features </a> </li> <li class=md-nav__item> <a href=../Berry/ class=md-nav__link> Berry Scripting Language :material-cpu-32-bit: </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Bluetooth Low Energy <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Bluetooth Low Energy </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#mi32-sensors class=md-nav__link> MI32 Sensors </a> <nav class=md-nav aria-label="MI32 Sensors"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#supported-devices class=md-nav__link> Supported Devices </a> </li> <li class=md-nav__item> <a href=#encryption-and-bind_key class=md-nav__link> Encryption and bind_key </a> </li> <li class=md-nav__item> <a href=#commands class=md-nav__link> Commands </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#ble-esp32 class=md-nav__link> BLE ESP32 </a> </li> <li class=md-nav__item> <a href=#ibeacon class=md-nav__link> iBeacon </a> <nav class=md-nav aria-label=iBeacon> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ibeacon-mqtt-fields class=md-nav__link> iBeacon MQTT Fields </a> </li> <li class=md-nav__item> <a href=#examples class=md-nav__link> Examples </a> </li> <li class=md-nav__item> <a href=#supported-devices_1 class=md-nav__link> Supported Devices </a> </li> <li class=md-nav__item> <a href=#mi32-mqtt-messages class=md-nav__link> MI32 MQTT Messages </a> </li> <li class=md-nav__item> <a href=#eq3-trv class=md-nav__link> EQ3 TRV </a> </li> <li class=md-nav__item> <a href=#commands_1 class=md-nav__link> Commands </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#ble-esp32_1 class=md-nav__link> BLE ESP32 </a> </li> <li class=md-nav__item> <a href=#ibeacon_1 class=md-nav__link> iBeacon </a> <nav class=md-nav aria-label=iBeacon> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ibeacon-mqtt-fields_1 class=md-nav__link> iBeacon MQTT Fields </a> </li> <li class=md-nav__item> <a href=#examples_1 class=md-nav__link> Examples </a> </li> <li class=md-nav__item> <a href=#supported-devices_2 class=md-nav__link> Supported Devices </a> </li> <li class=md-nav__item> <a href=#commands_2 class=md-nav__link> Commands </a> </li> <li class=md-nav__item> <a href=#eq3-trv_1 class=md-nav__link> EQ3 TRV </a> </li> <li class=md-nav__item> <a href=#commands_3 class=md-nav__link> Commands </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../TouchPin/ class=md-nav__link> Touch GPIOs </a> </li> <li class=md-nav__item> <a href=https://templates.blakadder.com/esp32 class=md-nav__link> Supported Devices </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Smart Home Integrations <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Smart Home Integrations" data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Smart Home Integrations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Integrations/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../Alexa/ class=md-nav__link> Alexa </a> </li> <li class=md-nav__item> <a href=../AWS-IoT/ class=md-nav__link> AWS IoT </a> </li> <li class=md-nav__item> <a href=../Domoticz/ class=md-nav__link> Domoticz </a> </li> <li class=md-nav__item> <a href=../Home-Assistant/ class=md-nav__link> Home Assistant </a> </li> <li class=md-nav__item> <a href=../Homebridge/ class=md-nav__link> Homebridge </a> </li> <li class=md-nav__item> <a href=../HomeSeer/ class=md-nav__link> HomeSeer </a> </li> <li class=md-nav__item> <a href=../IP-Symcon/ class=md-nav__link> IP Symcon </a> </li> <li class=md-nav__item> <a href=../KNX/ class=md-nav__link> KNX </a> </li> <li class=md-nav__item> <a href=../NodeRed/ class=md-nav__link> NodeRed </a> </li> <li class=md-nav__item> <a href=../nymea/ class=md-nav__link> nymea </a> </li> <li class=md-nav__item> <a href=../Octoprint/ class=md-nav__link> OctoPrint </a> </li> <li class=md-nav__item> <a href=../openHAB/ class=md-nav__link> openHAB </a> </li> <li class=md-nav__item> <a href=../otto/ class=md-nav__link> Otto </a> </li> <li class=md-nav__item> <a href=https://github.com/arendst/Tasmota/issues/3769 class=md-nav__link> IOBroker </a> </li> <li class=md-nav__item> <a href=https://github.com/tim-hellhake/tasmota-adapter class=md-nav__link> Mozilla WebThings Adapter </a> </li> <li class=md-nav__item> <a href=https://github.com/hongtat/tasmota-connect class=md-nav__link> SmartThings </a> </li> <li class=md-nav__item> <a href=https://github.com/Gifford47/tasmohab/blob/master/README.md class=md-nav__link> Tasmohab </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Peripherals <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Peripherals data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Peripherals </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Supported-Peripherals/ class=md-nav__link> Supported Peripherals </a> </li> <li class=md-nav__item> <a href=../Buzzer/ class=md-nav__link> Buzzer </a> </li> <li class=md-nav__item> <a href=../A4988-Stepper-Motor-Controller/ class=md-nav__link> A4988 stepper motor controller </a> </li> <li class=md-nav__item> <a href=../AHT1x/ class=md-nav__link> AHT1x temperature and humidity sensor </a> </li> <li class=md-nav__item> <a href=../AM2301/ class=md-nav__link> AM2301 temperature and humidity sensor </a> </li> <li class=md-nav__item> <a href=../APDS-9960/ class=md-nav__link> APDS-9960 light and gesture sensor </a> </li> <li class=md-nav__item> <a href=../AS3935/ class=md-nav__link> AS3935 Franklin Lightning sensor </a> </li> <li class=md-nav__item> <a href=../AZ-7798/ class=md-nav__link> AZ7798 CO~2~ meter </a> </li> <li class=md-nav__item> <a href=../BH1750/ class=md-nav__link> BH1750 ambient light sensor </a> </li> <li class=md-nav__item> <a href=../BME280/ class=md-nav__link> BME280 temperature, humidity and pressure sensor </a> </li> <li class=md-nav__item> <a href=../BME680/ class=md-nav__link> BME680 temperature, humidity, pressure and gas sensor </a> </li> <li class=md-nav__item> <a href=../CC2530/ class=md-nav__link> CC253x Zigbee module </a> </li> <li class=md-nav__item> <a href=../Moisture-Sensor-and-Chirp%21-Sensor/ class=md-nav__link> Chirp! moisture sensor </a> </li> <li class=md-nav__item> <a href=../DFR0299/ class=md-nav__link> DFRobot DFPlayer Mini MP3 Player </a> </li> <li class=md-nav__item> <a href=../DHT11/ class=md-nav__link> DHT11 temperature and humidity sensor </a> </li> <li class=md-nav__item> <a href=../DS18x20/ class=md-nav__link> DS18x20 temperature sensor </a> </li> <li class=md-nav__item> <a href=../DS3231/ class=md-nav__link> DS3231 Real Time Clock </a> </li> <li class=md-nav__item> <a href=../EZO/ class=md-nav__link> EZO sensors </a> </li> <li class=md-nav__item> <a href=../HM-10/ class=md-nav__link> HM-10 Bluetooth module </a> </li> <li class=md-nav__item> <a href=../HM-17/ class=md-nav__link> HM-17 Bluetooth module </a> </li> <li class=md-nav__item> <a href=../HC-SR04/ class=md-nav__link> HC-SR04 ultrasonic ranging sensor </a> </li> <li class=md-nav__item> <a href=../HRG15/ class=md-nav__link> Hydreon RG-15 Solid State Rain Sensor </a> </li> <li class=md-nav__item> <a href=../Honeywell-HIH/ class=md-nav__link> Honeywell HIH temperature and humidity sensor </a> </li> <li class=md-nav__item> <a href=../IAQ/ class=md-nav__link> iAQ-Core indoor air quality sensor </a> </li> <li class=md-nav__item> <a href=../IR-Remote/ class=md-nav__link> IR Remote </a> </li> <li class=md-nav__item> <a href=../LM75AD/ class=md-nav__link> LM75AD temperature sensor </a> </li> <li class=md-nav__item> <a href=../MCP230xx/ class=md-nav__link> MCP23008 / MCP23017 GPIO Expander </a> </li> <li class=md-nav__item> <a href=../MFRC522/ class=md-nav__link> MFRC522 RFID reader </a> </li> <li class=md-nav__item> <a href=../MGC3130/ class=md-nav__link> MGC3130 3D tracking and gesture controller </a> </li> <li class=md-nav__item> <a href=../MH-Z19B/ class=md-nav__link> MH-Z19B CO~2~ Sensor </a> </li> <li class=md-nav__item> <a href=../MLX90614/ class=md-nav__link> MLX90614 infrared thermometer </a> </li> <li class=md-nav__item> <a href=../MLX90640/ class=md-nav__link> MLX90640 Far infrared thermal sensor array </a> </li> <li class=md-nav__item> <a href=../MPR121/ class=md-nav__link> MPR121 capacitive touch sensor </a> </li> <li class=md-nav__item> <a href=../MPU-6050/ class=md-nav__link> MPU-6050 gyroscope and accelerometer </a> </li> <li class=md-nav__item> <a href=../NRF24L01/ class=md-nav__link> NRF24L01 module </a> </li> <li class=md-nav__item> <a href=../OpenTherm/ class=md-nav__link> OpenTherm </a> </li> <li class=md-nav__item> <a href=../P1-Smart-Meter/ class=md-nav__link> P1 Smart Meter </a> </li> <li class=md-nav__item> <a href=../PAJ7620/ class=md-nav__link> PAJ7620U2 gesture sensor </a> </li> <li class=md-nav__item> <a href=../PCA9685/ class=md-nav__link> PCA9685 12-bit PWM controller </a> </li> <li class=md-nav__item> <a href=../PN532/ class=md-nav__link> PN532 NFC reader </a> </li> <li class=md-nav__item> <a href=../PZEM-0XX/ class=md-nav__link> PZEM-0xx power monitor </a> </li> <li class=md-nav__item> <a href=../RCWL-0516/ class=md-nav__link> RCWL-0516 microwave radar motion sensor </a> </li> <li class=md-nav__item> <a href=../RDM6300/ class=md-nav__link> RDM6300 RFID reader </a> </li> <li class=md-nav__item> <a href=../RF-Transciever.md class=md-nav__link> None </a> </li> <li class=md-nav__item> <a href=../SDS011/ class=md-nav__link> SDS011 air quality sensor </a> </li> <li class=md-nav__item> <a href=../SHT30/ class=md-nav__link> SHT30 temperature sensor </a> </li> <li class=md-nav__item> <a href=../SK6812/ class=md-nav__link> SK6812 RGBW Addressable LEDs </a> </li> <li class=md-nav__item> <a href=../SPS30/ class=md-nav__link> SPS30 Particulate sensor </a> </li> <li class=md-nav__item> <a href=../TX2x/ class=md-nav__link> TX20/TX23/WS2300-15 anemometer </a> </li> <li class=md-nav__item> <a href=../TSL2561/ class=md-nav__link> TSL2561 light sensor </a> </li> <li class=md-nav__item> <a href=../VEML6070/ class=md-nav__link> VEML6070 UV light sensor </a> </li> <li class=md-nav__item> <a href=../VEML6075/ class=md-nav__link> VEML6075 UVA/UVB/UVINDEX Sensor </a> </li> <li class=md-nav__item> <a href=../VEML7700/ class=md-nav__link> VEML7700 Ambient light sensor </a> </li> <li class=md-nav__item> <a href=../VL53L0x/ class=md-nav__link> VL53L0X laser ranging module </a> </li> <li class=md-nav__item> <a href=../WS2812B-RGB-Shield/ class=md-nav__link> WS2812B RGB Shield </a> </li> <li class=md-nav__item> <a href=../WS2812B-and-WS2813/ class=md-nav__link> WS2812B and WS2813 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6> Supported Devices <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Supported Devices" data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Supported Devices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Configuration-Procedure-for-New-Devices/ class=md-nav__link> Configure Unknown Device </a> </li> <li class=md-nav__item> <a href="https://templates.blakadder.com/ " target='_blank""' class=md-nav__link> All Supported Devices </a> </li> <li class=md-nav__item> <a href=../Pinouts/ class=md-nav__link> Wi-Fi Module Pinouts </a> </li> <li class=md-nav__item> <a href=../Supported-Modules/ class=md-nav__link> Supported Modules </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7> Help <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Help data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Help </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../FAQ/ class=md-nav__link> FAQ </a> </li> <li class=md-nav__item> <a href=../Troubleshooting/ class=md-nav__link> Troubleshooting </a> </li> <li class=md-nav__item> <a href=../Device-Recovery/ class=md-nav__link> Device Recovery </a> </li> <li class=md-nav__item> <a href="https://discord.gg/Ks2Kzd4 " target='_blank""' class=md-nav__link> Discord Support </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Firmware-Builds/ class=md-nav__link> Firmware Builds </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#mi32-sensors class=md-nav__link> MI32 Sensors </a> <nav class=md-nav aria-label="MI32 Sensors"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#supported-devices class=md-nav__link> Supported Devices </a> </li> <li class=md-nav__item> <a href=#encryption-and-bind_key class=md-nav__link> Encryption and bind_key </a> </li> <li class=md-nav__item> <a href=#commands class=md-nav__link> Commands </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#ble-esp32 class=md-nav__link> BLE ESP32 </a> </li> <li class=md-nav__item> <a href=#ibeacon class=md-nav__link> iBeacon </a> <nav class=md-nav aria-label=iBeacon> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ibeacon-mqtt-fields class=md-nav__link> iBeacon MQTT Fields </a> </li> <li class=md-nav__item> <a href=#examples class=md-nav__link> Examples </a> </li> <li class=md-nav__item> <a href=#supported-devices_1 class=md-nav__link> Supported Devices </a> </li> <li class=md-nav__item> <a href=#mi32-mqtt-messages class=md-nav__link> MI32 MQTT Messages </a> </li> <li class=md-nav__item> <a href=#eq3-trv class=md-nav__link> EQ3 TRV </a> </li> <li class=md-nav__item> <a href=#commands_1 class=md-nav__link> Commands </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#ble-esp32_1 class=md-nav__link> BLE ESP32 </a> </li> <li class=md-nav__item> <a href=#ibeacon_1 class=md-nav__link> iBeacon </a> <nav class=md-nav aria-label=iBeacon> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ibeacon-mqtt-fields_1 class=md-nav__link> iBeacon MQTT Fields </a> </li> <li class=md-nav__item> <a href=#examples_1 class=md-nav__link> Examples </a> </li> <li class=md-nav__item> <a href=#supported-devices_2 class=md-nav__link> Supported Devices </a> </li> <li class=md-nav__item> <a href=#commands_2 class=md-nav__link> Commands </a> </li> <li class=md-nav__item> <a href=#eq3-trv_1 class=md-nav__link> EQ3 TRV </a> </li> <li class=md-nav__item> <a href=#commands_3 class=md-nav__link> Commands </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/tasmota/docs/blob/master/docs/Bluetooth_ESP32.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1>Bluetooth Low Energy</h1> <h2 id=mi32-sensors>MI32 Sensors<a class=headerlink href=#mi32-sensors title="Permanent link">~</a></h2> <div class="admonition failure"> <p class=admonition-title>This feature is included only in tasmota32-bluetooth.bin</p> </div> <p>Otherwise you must <a href=../Compile-your-build/ >compile your build</a>. Add the following to <code>user_config_override.h</code>:</p> <div class=highlight><pre><span></span><code><span class=cp>#define USE_MI_ESP32       </span><span class=c1>// (ESP32 only) Add support for ESP32 as a BLE-bridge (+9k2 mem, +292k flash)</span>
<span class=o>&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span><span class=w> </span><span class=n>HEAD</span><span class=w></span>
</code></pre></div> <p>Different vendors offer Bluetooth solutions, mostly as part of the Xiaomi brand, often under the Mijia label. The sensors supported by Tasmota use BLE (Bluetooth Low Energy) to transmit the sensor data, but they differ in their accessibilities quite substantially. </p> <p>Basically all of them use the so-called "MiBeacons" which are BLE advertisement packets with a certain data structure, which are broadcasted by the devices automatically while the device is not in an active Bluetooth connection. <br> The frequency of these messages is set by the vendor and ranges from one per 3 seconds to one per hour (f.e. for the battery status of the LYWSD03MMC). Motion sensors and BLE remote controls start to send when an event is triggered. <br> These packets already contain the sensor data and can be passively received by other devices and will be published regardless if a user decides to read out the sensors via connections or not. Thus the battery life of a BLE sensor is not influenced by reading these advertisements and the big advantage is the power efficiency as no active bi-directional connection has to be established. The other advantage is, that scanning for BLE advertisements can happen nearly parallel (very quickly one after the other), while a direct connection must be established for at least a few seconds and will then block both involved devices for that time. </p> <p>This is therefore the preferred option, if supported by the sensor.</p> <h3 id=supported-devices>Supported Devices<a class=headerlink href=#supported-devices title="Permanent link">~</a></h3> <div class="admonition note"> <p class=admonition-title>It can not be ruled out, that changes in the device firmware may break the functionality of this driver completely!</p> </div> <p>The naming conventions in the product range of Bluetooth sensors in Xiaomi universe can be a bit confusing. The exact same sensor can be advertised under slightly different names depending on the seller (Mijia, Xiaomi, Cleargrass, ...).</p> <table> <tr> <th class=th-lboi>MJ_HT_V1</th> <th class=th-lboi>LYWSD02</th> <th class=th-lboi>CGG1</th> <th class=th-lboi>CGD1</th> </tr> <tr> <td class=tg-lboi><img src=../_media/bluetooth/mj_ht_v1.png width=200></td> <td class=tg-lboi><img src=../_media/bluetooth/LYWDS02.png width=200></td> <td class=tg-lboi><img src=../_media/bluetooth/CGG1.png width=200></td> <td class=tg-lboi><img src=../_media/bluetooth/CGD1.png width=200></td> </tr> <tr> <td class=tg-lboi>temperature, humidity, battery</td> <td class=tg-lboi>temperature, humidity, battery</td> <td class=tg-lboi>temperature, humidity, battery</td> <td class=tg-lboi>temperature, humidity, battery</td> </tr> <tr> <td class=tg-lboi>passive for all entities, reliable battery value</td> <td class=tg-lboi>battery only active, thus not on the NRF24L01, set clock and unit, very frequent data sending</td> <td class=tg-lboi>passive for all entities, reliable battery value</td> <td class=tg-lboi>battery only active, thus not on the NRF24L01, no reliable battery value, no clock functions</td> </tr> </table> <table> <tr> <th class=th-lboi>MiFlora</th> <th class=th-lboi>LYWSD03MMC / ATC</th> <th class=th-lboi>NLIGHT</th> <th class=th-lboi>MJYD2S</th> </tr> <tr> <td class=tg-lboi><img src=../_media/bluetooth/miflora.png width=200></td> <td class=tg-lboi><img src=../_media/bluetooth/LYWSD03MMC.png width=200></td> <td class=tg-lboi><img src=../_media/bluetooth/nlight.png width=200></td> <td class=tg-lboi><img src=../_media/bluetooth/mjyd2s.png width=200></td> </tr> <tr> <td class=tg-lboi>temperature, illuminance, soil humidity, soil fertility, battery, firmware version</td> <td class=tg-lboi>temperature, humidity, battery</td> <td class=tg-lboi>motion</td> <td class=tg-lboi>motion, illuminance, battery, no-motion-time</td> </tr> <tr> <td class=tg-lboi>passive only with newer firmware (>3.0?), battery only active, thus not on the NRF24L01</td> <td class=tg-lboi>passive only with decryption or using custom ATC-firmware, no reliable battery value with stock firmware</td> <td class=tg-lboi>NRF24L01, ESP32</td> <td class=tg-lboi>passive only with decryption, thus only NRF24L01, ESP32</td> </tr> </table> <table> <tr> <th class=th-lboi>YEE RC</th> <th class=th-lboi>MHO-C401</th> <th class=th-lboi>MHO-C303</th> <th class=th-lboi>MCCGQ02HL</th> </tr> <tr> <td class=tg-lboi><img src=../_media/bluetooth/yeerc.png width=200></td> <td class=tg-lboi><img src=../_media/bluetooth/MHO-C401.png width=200></td> <td class=tg-lboi><img src=../_media/bluetooth/MHO-C303.png width=200></td> <td class=tg-lboi><img src=../_media/bluetooth/MCCGQ02HL.png width=200></td> </tr> <tr> <td class=tg-lboi>button press (single and long)</td> <td class=tg-lboi>temperature, humidity, battery</td> <td class=tg-lboi>temperature, humidity, battery</td> <td class=tg-lboi>door opening/closing, light present</td> </tr> <tr> <td class=tg-lboi>passive</td> <td class=tg-lboi>equal to the LYWS03MMC, but no custom firmware yet</td> <td class=tg-lboi>passive for all entities, set clock and unit, no alarm functions, very frequent data sending</td> <td class=tg-lboi>passive, difficult to get key (must be close, press button)</td> </tr> </table> <p><em>passive</em> means data is received via BLE advertisements while <em>active</em> means data is received via a bidirectional connection to the sensor.</p> <p><strong>LYWSD03MMC</strong> sends encrypted sensor data every 10 minutes. As there are no confirmed reports about correct battery presentation of the sensor (always shows 99%), this function is currently not supported. </p> <p><strong>MJYD2S</strong> sends motion detection events and 2 discrete illuminance levels (1 lux or 100 lux for a dark or bright environment). Additionally battery level and contiguous time without motion in discrete growing steps (no motion time = NMT). </p> <h3 id=encryption-and-bind_key>Encryption and bind_key<a class=headerlink href=#encryption-and-bind_key title="Permanent link">~</a></h3> <p>Most of the older sensors use unencrypted messages, which can be read by all kinds of BLE devices or even a NRF24L01. With the arrival of newer sensors, such as LYWSD03MMC, MHO-C401 or MJYD2S, came the problem of encrypted data in MiBeacons, which can be decrypted in Tasmota.</p> <p>Some sensor still allow an unencrypted connection the reading of the sensor data using normal subscription methods to GATT-services. This is more power hungry than the passive reading of BLE advertisements. </p> <p>Some other sensors like the MJYD2S are not usable without the "bind_key". </p> <p>It is recommended to obtain the bind_key in any case to reduce the battery drain. </p> <h4 id=obtain-bind_key>Obtain bind_key<a class=headerlink href=#obtain-bind_key title="Permanent link">~</a></h4> <p>To get the necessary decryption key ("bind_key") use:</p> <ul> <li><a href=https://github.com/PiotrMachowski/Xiaomi-cloud-tokens-extractor>Xiaomi Cloud Tokens Extractor</a> (Windows executable or Python) - works on any device in the Mi Home app</li> <li><a href=https://pvvx.github.io/ATC_MiThermometer/TelinkMiFlasher.html>pvvx Telink Flasher</a> (Webpage) - LYWSD03MMC, MHO-C401 and CGG1 only</li> <li><a href=https://atc1441.github.io/TelinkFlasher.html>ATC Telink Flasher</a> (Webpage) - LYWSD03MMC only</li> </ul> <p>Telink Flashers allow the generation of a bind_key by faking a pairing with the Xiaomi cloud.</p> <h4 id=use-bind_key>Use bind_key<a class=headerlink href=#use-bind_key title="Permanent link">~</a></h4> <p>Use the bind_key and MAC address of the sensor to use with commands <code>Mi32Keys</code> or <code>Mi32Key</code>. Tasmota will receive the sensor data roughly every 10 minutes (in two chunks for humidity and temperature with about a minute in between) and decode the data. This is the most energy efficient way. </p> <p>The current way of storing these keys on the ESP32 is to use <a href=../Commands/#mi32key><code>Mi32Key</code></a> command: </p> <p><code>MI32Keys &lt;mac or blealias&gt;=&lt;bind_key&gt; &lt;mac or blealias&gt;=&lt;key&gt;</code></p> <p>The Key is the 32 character (16 byte) key retrieved by above methods. </p> <p>Older way of using <code>MI32Key</code> is retained for backward compatibility. Mi32Key needs a 44 character combination of bind_key and MAC:</p> <p><code>MI32Keys &lt;bind_keymac&gt;</code></p> <p>To retain the data use a rule on startup: <div class=highlight><pre><span></span><code><span class=nf>rule1</span> <span class=n>on</span> <span class=kt>System</span><span class=o>#</span><span class=kt>Boot</span> <span class=kr>do</span> <span class=n>backlog</span> <span class=kt>MI32key</span> <span class=mi>00112233445566778899</span><span class=kt>AABBCCDDEEFF112233445566</span><span class=p>;</span> <span class=kt>MI32key</span> <span class=mi>00112233445566778899</span><span class=kt>AABBCCDDEEFFAABBCCDDEEFF</span> <span class=n>endon</span>
</code></pre></div></p> <h3 id=commands>Commands<a class=headerlink href=#commands title="Permanent link">~</a></h3> <p>Full list of available <a href=../Commands/#ble-mi-sensors>Mi Sensors commands</a>.</p> <div class="admonition tip"> <p class=admonition-title>Tip</p> </div> <p>If you really want to read battery for LYWSD02, Flora and CGD1, consider doing it once a day with a rule:</p> <div class=highlight><pre><span></span><code><span class=kt>Backlog</span> <span class=kt>Rule1</span> <span class=n>on</span> <span class=kt>Time</span><span class=o>#</span><span class=kt>Minute</span><span class=ow>=</span><span class=mi>30</span> <span class=kr>do</span> <span class=kt>MI32Battery</span> <span class=n>endon</span><span class=p>;</span> <span class=kt>Rule1</span> <span class=mi>1</span>
</code></pre></div> <p>This will update every day at 00:30 AM. </p> <h2 id=ble-esp32>BLE ESP32<a class=headerlink href=#ble-esp32 title="Permanent link">~</a></h2> <p>This allows for the receiving of BLE advertisements from BLE devices, including "iBeacons" and BLE sensors, but also for the control of simple BLE devices, providing for reading, writing and receiving notifications. </p> <div class="admonition failure"> <p class=admonition-title>This feature is included only in tasmota32-bluetooth.bin</p> </div> <p>Otherwise you must <a href=../Compile-your-build/ >compile your build</a>. Add the following to <code>user_config_override.h</code>:</p> <div class=highlight><pre><span></span><code><span class=cp>#define USE_BLE_ESP32                </span><span class=c1>// Add support for ESP32 as a BLE-bridge (+9k2? mem, +292k? flash)</span>
</code></pre></div> <p>Be aware, enabling of the native BLE on ESP32 has an impact on Wi-Fi performance. Although later SDK helped a bit, expect more lag on the web interface and on MQTT. If only controlling BLE devices, then scanning can be disabled, which will minimize Wi-Fi impact. BLE can be enabled from the web UI menus. </p> <p>This is compiled by default in the Bluetooth firmware, but you need to enable it using the webUI <strong>Configure BLE</strong> button or <a href=../Commands/#setoption115><code>SetOption115 1</code></a> command.</p> <p>Note that the only configuration stored is the <a href=../Commands/#setoption115><code>SetOption115</code></a> to turn BLE on and off. All other configurations can be set at boot if necessary using Rules.</p> <h2 id=ibeacon>iBeacon<a class=headerlink href=#ibeacon title="Permanent link">~</a></h2> <p>Hear adverts from BLE devices, and produce MQTT messages containing RSSI and other information about them. Break out iBeacon specific data if present. </p> <div class="admonition failure"> <p class=admonition-title>This feature is not included in precompiled binaries</p> </div> <div class=highlight><pre><span></span><code>#define USE_IBEACON_ESP32                // Add support for Bluetooth LE passive scan of iBeacon devices
</code></pre></div> <p>This driver reports all beacons found during a scan with its ID (derived from beacon's MAC address) prefixed with <code>IBEACON_</code> and RSSI value.</p> <p>Every beacon report is published as an MQTT tele/%topic%/SENSOR in a separate message:</p> <div class=highlight><pre><span></span><code><span class=kc>tele</span><span class=err>/ibeaco</span><span class=kc>n</span><span class=err>/SENSOR</span> <span class=err>=</span> <span class=p>{</span><span class=nt>&quot;Time&quot;</span><span class=p>:</span><span class=s2>&quot;2021-01-02T12:08:40&quot;</span><span class=p>,</span><span class=nt>&quot;IBEACON&quot;</span><span class=p>:{</span><span class=nt>&quot;MAC&quot;</span><span class=p>:</span><span class=s2>&quot;A4C1387FC1E1&quot;</span><span class=p>,</span><span class=nt>&quot;RSSI&quot;</span><span class=p>:</span><span class=mi>-56</span><span class=p>,</span><span class=nt>&quot;STATE&quot;</span><span class=p>:</span><span class=s2>&quot;ON&quot;</span><span class=p>}}</span>
</code></pre></div> <p>If the beacon can no longer be found during a scan and the timeout interval has passed the beacon's RSSI is set to zero (0) and it is no longer displayed in the webUI</p> <div class=highlight><pre><span></span><code><span class=kc>tele</span><span class=err>/ibeaco</span><span class=kc>n</span><span class=err>/SENSOR</span> <span class=err>=</span> <span class=p>{</span><span class=nt>&quot;Time&quot;</span><span class=p>:</span><span class=s2>&quot;2021-01-02T12:08:40&quot;</span><span class=p>,</span><span class=nt>&quot;IBEACON&quot;</span><span class=p>:{</span><span class=nt>&quot;MAC&quot;</span><span class=p>:</span><span class=s2>&quot;A4C1387FC1E1&quot;</span><span class=p>,</span><span class=nt>&quot;RSSI&quot;</span><span class=p>:</span><span class=mi>-56</span><span class=p>,</span><span class=nt>&quot;STATE&quot;</span><span class=p>:</span><span class=s2>&quot;OFF&quot;</span><span class=p>}}</span>
</code></pre></div> <p>Additional fields will be present depending upon the beacon, e.g. NAME, UID, MAJOR, MINOR.</p> <h3 id=ibeacon-mqtt-fields>iBeacon MQTT Fields<a class=headerlink href=#ibeacon-mqtt-fields title="Permanent link">~</a></h3> <h4 id=always-present>Always present<a class=headerlink href=#always-present title="Permanent link">~</a></h4> <table> <thead> <tr> <th align=left>json</th> <th align=left>meaning</th> </tr> </thead> <tbody> <tr> <td align=left>Time</td> <td align=left>time of MQTT send</td> </tr> <tr> <td align=left>IBEACON.MAC</td> <td align=left>mac addr</td> </tr> <tr> <td align=left>IBEACON.RSSI</td> <td align=left>signal strength</td> </tr> <tr> <td align=left>IBEACON.STATE</td> <td align=left>ON - present, OFF - last MQTT you will get for now (device removed)</td> </tr> </tbody> </table> <h4 id=optional>Optional<a class=headerlink href=#optional title="Permanent link">~</a></h4> <table> <thead> <tr> <th align=left>json</th> <th align=left>meaning</th> </tr> </thead> <tbody> <tr> <td align=left>IBEACON.NAME</td> <td align=left>name if in scan, or BLEAlias if set - only present if NAME present</td> </tr> <tr> <td align=left>IBEACON.PERSEC</td> <td align=left>count of adverts per sec. Useful for detecting button press</td> </tr> <tr> <td align=left>IBEACON.MAJOR</td> <td align=left>some iBeacon related term? - only present for some</td> </tr> <tr> <td align=left>IBEACON.MINOR</td> <td align=left>some iBeacon related term? - only present for some</td> </tr> </tbody> </table> <h3 id=examples>Examples<a class=headerlink href=#examples title="Permanent link">~</a></h3> <h4 id=setup-a-rule-to-set-some-aliases-at-boot-time-and-only-allow-those-starting-ib>Setup a rule to set some aliases at boot time, and only allow those starting <code>iB</code><a class=headerlink href=#setup-a-rule-to-set-some-aliases-at-boot-time-and-only-allow-those-starting-ib title="Permanent link">~</a></h4> <div class=highlight><pre><span></span><code><span class=go>Rule1 ON System#Boot DO backlog iBeacon 1; BLEAlias A4C1386A1E24=iBfred A4C1387FC1E1=iBjames; iBeaconOnlyAliased 2 endon</span>
<span class=go>Rule1 1</span>
</code></pre></div> <h3 id=supported-devices_1>Supported Devices<a class=headerlink href=#supported-devices_1 title="Permanent link">~</a></h3> <p><img src=../_media/bluetooth/nRF51822.png width=155 align=right></p> <p>All Apple compatible iBeacon devices should be discoverable. </p> <p>Various nRF51822 beacons should be fully Apple compatible, programmable and their battery lasts about a year.</p> <ul> <li><a href="https://www.amazon.com/s?k=nRF51822+4.0">Amazon.com</a></li> <li><a href=https://www.aliexpress.com/af/NRF51822-beacon.html>Aliexpress</a></li> </ul> <p>Cheap "iTag" beacons with a beeper. The battery on these lasts only about a month.</p> <ul> <li><a href="https://www.aliexpress.com/af/itag.html?trafficChannel=af&SearchText=itag&ltype=affiliate&SortType=default&g=y&CatId=0">Aliexpress</a></li> <li><a href="https://www.ebay.de/sch/i.html?_from=R40&_trksid=m570.l1313&_nkw=Smart-Tag-GPS-Tracker-Bluetooth-Anti-verlorene-Alarm-Key-Finder-Haustier-Kind&_sacat=0">eBay</a></li> <li><a href="https://www.amazon.com/s?k=itag+tracker+4.0">Amazon.com</a></li> </ul> <p><img src=../_media/bluetooth/itag.png width=225><img src=../_media/bluetooth/itag2.png width=225><img src=../_media/bluetooth/itag3.png width=225></p> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>You can activate a beacon with a beeper using command <code>IBEACON_%BEACONID%_RSSI 99</code> (ID is visible in webUI and SENSOR reports). This command can freeze the Bluetooth module and beacon scanning will stop. After a reboot of Tasmota the beacon will start beeping and scanning will resume. (untested on ESP32 native BLE) </p> </div> <h3 id=mi32-mqtt-messages>MI32 MQTT Messages<a class=headerlink href=#mi32-mqtt-messages title="Permanent link">~</a></h3> <p>Because we can have many sensors reporting, tele messages are chunked to have a maximum of four sensors per message.</p> <p>If you enable MQTT discovery (<a href=../Commands/#setoption19><code>SetOption19 1</code></a>), additional MQTT messages are send.</p> <p>Primarily, at teleperiod or MI32period, discovery messages are sent. These inform Home Assistant about the devices. Device names can be dependent upon BLEAlias, so set <code>BLEAlias</code> at boot.</p> <p>Additional actual data messages are sent on topics including the device name: <code>tele/tasmota_ble/&lt;name&gt;</code></p> <p>Each message for <strong>one</strong> sensor.</p> <p>These messages can be used without Home Assistant if it is a preferred format.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The topic would be the <strong>same</strong> from all Tasmotas if they have the same BLEAlias or no BLEAlias. So if you wish to 'hear' the same device separately from different Tasmotas, use different BLEAlias names. </p> </div> <h3 id=eq3-trv>EQ3 TRV<a class=headerlink href=#eq3-trv title="Permanent link">~</a></h3> <p>======= <div class=highlight><pre><span></span><code>Different vendors offer Bluetooth solutions, mostly as part of the Xiaomi brand, often under the Mijia label. The sensors supported by Tasmota use BLE (Bluetooth Low Energy) to transmit the sensor data, but they differ in their accessibilities quite substantially.  

Basically all of them use the so-called &quot;MiBeacons&quot; which are BLE advertisement packets with a certain data structure, which are broadcasted by the devices automatically while the device is not in an active Bluetooth connection.       
The frequency of these messages is set by the vendor and ranges from one per 3 seconds to one per hour (f.e. for the battery status of the LYWSD03MMC). Motion sensors and BLE remote controls start to send when an event is triggered.     
These packets already contain the sensor data and can be passively received by other devices and will be published regardless if a user decides to read out the sensors via connections or not. Thus the battery life of a BLE sensor is not influenced by reading these advertisements and the big advantage is the power efficiency as no active bi-directional connection has to be established. The other advantage is, that scanning for BLE advertisements can happen nearly parallel (very quickly one after the other), while a direct connection must be established for at least a few seconds and will then block both involved devices for that time.  

This is therefore the preferred option, if supported by the sensor.

### Supported Devices

!!! note &quot;It can not be ruled out, that changes in the device firmware may break the functionality of this driver completely!&quot;  

The naming conventions in the product range of Bluetooth sensors in Xiaomi universe can be a bit confusing. The exact same sensor can be advertised under slightly different names depending on the seller (Mijia, Xiaomi, Cleargrass, ...).

 &lt;table&gt;
  &lt;tr&gt;
    &lt;th class=&quot;th-lboi&quot;&gt;MJ_HT_V1&lt;/th&gt;
    &lt;th class=&quot;th-lboi&quot;&gt;LYWSD02&lt;/th&gt;
    &lt;th class=&quot;th-lboi&quot;&gt;CGG1&lt;/th&gt;
    &lt;th class=&quot;th-lboi&quot;&gt;CGD1&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class=&quot;tg-lboi&quot;&gt;&lt;img src=&quot;../_media/bluetooth/mj_ht_v1.png&quot; width=200&gt;&lt;/td&gt;
    &lt;td class=&quot;tg-lboi&quot;&gt;&lt;img src=&quot;../_media/bluetooth/LYWDS02.png&quot; width=200&gt;&lt;/td&gt;
    &lt;td class=&quot;tg-lboi&quot;&gt;&lt;img src=&quot;../_media/bluetooth/CGG1.png&quot; width=200&gt;&lt;/td&gt;
    &lt;td class=&quot;tg-lboi&quot;&gt;&lt;img src=&quot;../_media/bluetooth/CGD1.png&quot; width=200&gt;&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class=&quot;tg-lboi&quot;&gt;temperature, humidity, battery&lt;/td&gt;
    &lt;td class=&quot;tg-lboi&quot;&gt;temperature, humidity, battery&lt;/td&gt;
    &lt;td class=&quot;tg-lboi&quot;&gt;temperature, humidity, battery&lt;/td&gt;
    &lt;td class=&quot;tg-lboi&quot;&gt;temperature, humidity, battery&lt;/td&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td class=&quot;tg-lboi&quot;&gt;passive for all entities, reliable battery value&lt;/td&gt;
    &lt;td class=&quot;tg-lboi&quot;&gt;battery only active, thus not on the NRF24L01, set clock and unit, very frequent data sending&lt;/td&gt;
    &lt;td class=&quot;tg-lboi&quot;&gt;passive for all entities, reliable battery value&lt;/td&gt;
    &lt;td class=&quot;tg-lboi&quot;&gt;battery only active, thus not on the NRF24L01, no reliable battery value, no clock functions&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;  

 &lt;table&gt;
  &lt;tr&gt;
    &lt;th class=&quot;th-lboi&quot;&gt;MiFlora&lt;/th&gt;
    &lt;th class=&quot;th-lboi&quot;&gt;LYWSD03MMC / ATC&lt;/th&gt;
    &lt;th class=&quot;th-lboi&quot;&gt;NLIGHT&lt;/th&gt;
    &lt;th class=&quot;th-lboi&quot;&gt;MJYD2S&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class=&quot;tg-lboi&quot;&gt;&lt;img src=&quot;../_media/bluetooth/miflora.png&quot; width=200&gt;&lt;/td&gt;
    &lt;td class=&quot;tg-lboi&quot;&gt;&lt;img src=&quot;../_media/bluetooth/LYWSD03MMC.png&quot; width=200&gt;&lt;/td&gt;
    &lt;td class=&quot;tg-lboi&quot;&gt;&lt;img src=&quot;../_media/bluetooth/nlight.png&quot; width=200&gt;&lt;/td&gt;
    &lt;td class=&quot;tg-lboi&quot;&gt;&lt;img src=&quot;../_media/bluetooth/mjyd2s.png&quot; width=200&gt;&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class=&quot;tg-lboi&quot;&gt;temperature, illuminance, soil humidity, soil fertility, battery, firmware version&lt;/td&gt;
    &lt;td class=&quot;tg-lboi&quot;&gt;temperature, humidity, battery&lt;/td&gt;
    &lt;td class=&quot;tg-lboi&quot;&gt;motion&lt;/td&gt;
    &lt;td class=&quot;tg-lboi&quot;&gt;motion, illuminance, battery, no-motion-time&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class=&quot;tg-lboi&quot;&gt;passive only with newer firmware (&gt;3.0?), battery only active, thus not on the NRF24L01&lt;/td&gt;
    &lt;td class=&quot;tg-lboi&quot;&gt;passive only with decryption or using custom ATC-firmware, no reliable battery value with stock firmware&lt;/td&gt;
    &lt;td class=&quot;tg-lboi&quot;&gt;NRF24L01, ESP32&lt;/td&gt;
    &lt;td class=&quot;tg-lboi&quot;&gt;passive only with decryption, thus only NRF24L01, ESP32&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;  

 &lt;table&gt;
  &lt;tr&gt;
    &lt;th class=&quot;th-lboi&quot;&gt;YEE RC&lt;/th&gt;
    &lt;th class=&quot;th-lboi&quot;&gt;MHO-C401&lt;/th&gt;
    &lt;th class=&quot;th-lboi&quot;&gt;MHO-C303&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class=&quot;tg-lboi&quot;&gt;&lt;img src=&quot;../_media/bluetooth/yeerc.png&quot; width=200&gt;&lt;/td&gt;
    &lt;td class=&quot;tg-lboi&quot;&gt;&lt;img src=&quot;../_media/bluetooth/MHO-C401.png&quot; width=200&gt;&lt;/td&gt;
    &lt;td class=&quot;tg-lboi&quot;&gt;&lt;img src=&quot;../_media/bluetooth/MHO-C303.png&quot; width=200&gt;&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td class=&quot;tg-lboi&quot;&gt;button press (single and long)&lt;/td&gt;
    &lt;td class=&quot;tg-lboi&quot;&gt;temperature, humidity, battery&lt;/td&gt;
    &lt;td class=&quot;tg-lboi&quot;&gt;temperature, humidity, battery&lt;/td&gt;
  &lt;/tr&gt;
     &lt;tr&gt;
    &lt;td class=&quot;tg-lboi&quot;&gt;passive&lt;/td&gt;
    &lt;td class=&quot;tg-lboi&quot;&gt;equal to the LYWS03MMC, but no custom firmware yet&lt;/td&gt;
    &lt;td class=&quot;tg-lboi&quot;&gt;passive for all entities,  set clock and unit, no alarm functions, very frequent data sending&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt; 

*passive* means data is received via BLE advertisements while *active* means data is received via a bidirectional connection to the sensor.

**LYWSD03MMC** sends encrypted sensor data every 10 minutes. As there are no confirmed reports about correct battery presentation of the sensor (always shows 99%), this function is currently not supported.  

**MJYD2S** sends motion detection events and 2 discrete illuminance levels (1 lux or 100 lux for a dark or bright environment). Additionally battery level and contiguous time without motion in discrete growing steps (no motion time = NMT).    

### Encryption and bind_key 

Most of the older sensors use unencrypted messages, which can be read by all kinds of BLE devices or even a NRF24L01. With the arrival of newer sensors, such as LYWSD03MMC, MHO-C401 or MJYD2S, came the problem of encrypted data in MiBeacons, which can be decrypted in Tasmota.

Some sensor still allow an unencrypted connection the reading of the sensor data using normal subscription methods to GATT-services. This is more power hungry than the passive reading of BLE advertisements. 

Some other sensors like the MJYD2S are not usable without the &quot;bind_key&quot;. 

It is recommended to obtain the bind_key in any case to reduce the battery drain.  

#### Obtain bind_key

To get the necessary decryption key (&quot;bind_key&quot;) use:

- [Xiaomi Cloud Tokens Extractor](https://github.com/PiotrMachowski/Xiaomi-cloud-tokens-extractor) (Windows executable or Python) - works on any device in the Mi Home app
- [pvvx Telink Flasher](https://pvvx.github.io/ATC_MiThermometer/TelinkMiFlasher.html) (Webpage) - LYWSD03MMC, MHO-C401 and CGG1 only
- [ATC Telink Flasher](https://atc1441.github.io/TelinkFlasher.html) (Webpage) - LYWSD03MMC only

Telink Flashers allow the generation of a bind_key by faking a pairing with the Xiaomi cloud.

#### Use bind_key

Use the bind_key and MAC address of the sensor to use with commands `Mi32Keys` or `Mi32Key`. Tasmota will receive the sensor data roughly every 10 minutes (in two chunks for humidity and temperature with about a minute in between) and decode the data. This is the most energy efficient way. 

The current way of storing these keys on the ESP32 is to use [`Mi32Key`](Commands.md#mi32key) command:  

`MI32Keys &lt;mac or blealias&gt;=&lt;bind_key&gt; &lt;mac or blealias&gt;=&lt;key&gt;`

The Key is the 32 character (16 byte) key retrieved by above methods.  

Older way of using `MI32Key` is retained for backward compatibility. Mi32Key needs a 44 character combination of bind_key and MAC:

`MI32Keys &lt;bind_keymac&gt;`

To retain the data use a rule on startup:
```haskell
rule1 on System#Boot do backlog MI32key 00112233445566778899AABBCCDDEEFF112233445566; MI32key 00112233445566778899AABBCCDDEEFFAABBCCDDEEFF endon
</code></pre></div></p> <h3 id=commands_1>Commands<a class=headerlink href=#commands_1 title="Permanent link">~</a></h3> <p>Full list of available <a href=../Commands/#ble-mi-sensors>Mi Sensors commands</a>.</p> <div class="admonition tip"> <p class=admonition-title>Tip</p> </div> <p>If you really want to read battery for LYWSD02, Flora and CGD1, consider doing it once a day with a rule:</p> <div class=highlight><pre><span></span><code><span class=kt>Backlog</span> <span class=kt>Rule1</span> <span class=n>on</span> <span class=kt>Time</span><span class=o>#</span><span class=kt>Minute</span><span class=ow>=</span><span class=mi>30</span> <span class=kr>do</span> <span class=kt>MI32Battery</span> <span class=n>endon</span><span class=p>;</span> <span class=kt>Rule1</span> <span class=mi>1</span>
</code></pre></div> <p>This will update every day at 00:30 AM. </p> <h2 id=ble-esp32_1>BLE ESP32<a class=headerlink href=#ble-esp32_1 title="Permanent link">~</a></h2> <p>This allows for the receiving of BLE advertisements from BLE devices, including "iBeacons" and BLE sensors, but also for the control of simple BLE devices, providing for reading, writing and receiving notifications. </p> <div class="admonition failure"> <p class=admonition-title>This feature is included only in tasmota32-bluetooth.bin</p> </div> <p>Otherwise you must <a href=../Compile-your-build/ >compile your build</a>. Add the following to <code>user_config_override.h</code>:</p> <div class=highlight><pre><span></span><code><span class=cp>#define USE_BLE_ESP32                </span><span class=c1>// Add support for ESP32 as a BLE-bridge (+9k2? mem, +292k? flash)</span>
</code></pre></div> <p>Be aware, enabling of the native BLE on ESP32 has an impact on Wi-Fi performance. Although later SDK helped a bit, expect more lag on the web interface and on MQTT. If only controlling BLE devices, then scanning can be disabled, which will minimize Wi-Fi impact. BLE can be enabled from the web UI menus. </p> <p>This is compiled by default in the Bluetooth firmware, but you need to enable it using the webUI <strong>Configure BLE</strong> button or <a href=../Commands/#setoption115><code>SetOption115 1</code></a> command.</p> <p>Note that the only configuration stored is the <a href=../Commands/#setoption115><code>SetOption115</code></a> to turn BLE on and off. All other configurations can be set at boot if necessary using Rules.</p> <h2 id=ibeacon_1>iBeacon<a class=headerlink href=#ibeacon_1 title="Permanent link">~</a></h2> <p>Hear adverts from BLE devices, and produce MQTT messages containing RSSI and other information about them. Break out iBeacon specific data if present. </p> <div class="admonition failure"> <p class=admonition-title>This feature is not included in precompiled binaries</p> </div> <div class=highlight><pre><span></span><code>#define USE_IBEACON_ESP32                // Add support for Bluetooth LE passive scan of iBeacon devices
</code></pre></div> <p>This driver reports all beacons found during a scan with its ID (derived from beacon's MAC address) prefixed with <code>IBEACON_</code> and RSSI value.</p> <p>Every beacon report is published as an MQTT tele/%topic%/SENSOR in a separate message:</p> <div class=highlight><pre><span></span><code><span class=kc>tele</span><span class=err>/ibeaco</span><span class=kc>n</span><span class=err>/SENSOR</span> <span class=err>=</span> <span class=p>{</span><span class=nt>&quot;Time&quot;</span><span class=p>:</span><span class=s2>&quot;2021-01-02T12:08:40&quot;</span><span class=p>,</span><span class=nt>&quot;IBEACON&quot;</span><span class=p>:{</span><span class=nt>&quot;MAC&quot;</span><span class=p>:</span><span class=s2>&quot;A4C1387FC1E1&quot;</span><span class=p>,</span><span class=nt>&quot;RSSI&quot;</span><span class=p>:</span><span class=mi>-56</span><span class=p>,</span><span class=nt>&quot;STATE&quot;</span><span class=p>:</span><span class=s2>&quot;ON&quot;</span><span class=p>}}</span>
</code></pre></div> <p>If the beacon can no longer be found during a scan and the timeout interval has passed the beacon's RSSI is set to zero (0) and it is no longer displayed in the webUI</p> <div class=highlight><pre><span></span><code><span class=kc>tele</span><span class=err>/ibeaco</span><span class=kc>n</span><span class=err>/SENSOR</span> <span class=err>=</span> <span class=p>{</span><span class=nt>&quot;Time&quot;</span><span class=p>:</span><span class=s2>&quot;2021-01-02T12:08:40&quot;</span><span class=p>,</span><span class=nt>&quot;IBEACON&quot;</span><span class=p>:{</span><span class=nt>&quot;MAC&quot;</span><span class=p>:</span><span class=s2>&quot;A4C1387FC1E1&quot;</span><span class=p>,</span><span class=nt>&quot;RSSI&quot;</span><span class=p>:</span><span class=mi>-56</span><span class=p>,</span><span class=nt>&quot;STATE&quot;</span><span class=p>:</span><span class=s2>&quot;OFF&quot;</span><span class=p>}}</span>
</code></pre></div> <p>Additional fields will be present depending upon the beacon, e.g. NAME, UID, MAJOR, MINOR.</p> <h3 id=ibeacon-mqtt-fields_1>iBeacon MQTT Fields<a class=headerlink href=#ibeacon-mqtt-fields_1 title="Permanent link">~</a></h3> <h4 id=always-present_1>Always present<a class=headerlink href=#always-present_1 title="Permanent link">~</a></h4> <table> <thead> <tr> <th align=left>json</th> <th align=left>meaning</th> </tr> </thead> <tbody> <tr> <td align=left>Time</td> <td align=left>time of MQTT send</td> </tr> <tr> <td align=left>IBEACON.MAC</td> <td align=left>mac addr</td> </tr> <tr> <td align=left>IBEACON.RSSI</td> <td align=left>signal strength</td> </tr> <tr> <td align=left>IBEACON.STATE</td> <td align=left>ON - present, OFF - last MQTT you will get for now (device removed)</td> </tr> </tbody> </table> <h4 id=optional_1>Optional<a class=headerlink href=#optional_1 title="Permanent link">~</a></h4> <table> <thead> <tr> <th align=left>json</th> <th align=left>meaning</th> </tr> </thead> <tbody> <tr> <td align=left>IBEACON.NAME</td> <td align=left>name if in scan, or BLEAlias if set - only present if NAME present</td> </tr> <tr> <td align=left>IBEACON.PERSEC</td> <td align=left>count of adverts per sec. Useful for detecting button press</td> </tr> <tr> <td align=left>IBEACON.MAJOR</td> <td align=left>some iBeacon related term? - only present for some</td> </tr> <tr> <td align=left>IBEACON.MINOR</td> <td align=left>some iBeacon related term? - only present for some</td> </tr> </tbody> </table> <h3 id=examples_1>Examples<a class=headerlink href=#examples_1 title="Permanent link">~</a></h3> <h4 id=setup-a-rule-to-set-some-aliases-at-boot-time-and-only-allow-those-starting-ib_1>Setup a rule to set some aliases at boot time, and only allow those starting <code>iB</code><a class=headerlink href=#setup-a-rule-to-set-some-aliases-at-boot-time-and-only-allow-those-starting-ib_1 title="Permanent link">~</a></h4> <div class=highlight><pre><span></span><code><span class=go>Rule1 ON System#Boot DO backlog iBeacon 1; BLEAlias A4C1386A1E24=iBfred A4C1387FC1E1=iBjames; iBeaconOnlyAliased 2 endon</span>
<span class=go>Rule1 1</span>
</code></pre></div> <h3 id=supported-devices_2>Supported Devices<a class=headerlink href=#supported-devices_2 title="Permanent link">~</a></h3> <p><img src=../_media/bluetooth/nRF51822.png width=155 align=right></p> <p>All Apple compatible iBeacon devices should be discoverable. </p> <p>Various nRF51822 beacons should be fully Apple compatible, programmable and their battery lasts about a year.</p> <ul> <li><a href="https://www.amazon.com/s?k=nRF51822+4.0">Amazon.com</a></li> <li><a href=https://www.aliexpress.com/af/NRF51822-beacon.html>Aliexpress</a></li> </ul> <p>Cheap "iTag" beacons with a beeper. The battery on these lasts only about a month.</p> <ul> <li><a href="https://www.aliexpress.com/af/itag.html?trafficChannel=af&SearchText=itag&ltype=affiliate&SortType=default&g=y&CatId=0">Aliexpress</a></li> <li><a href="https://www.ebay.de/sch/i.html?_from=R40&_trksid=m570.l1313&_nkw=Smart-Tag-GPS-Tracker-Bluetooth-Anti-verlorene-Alarm-Key-Finder-Haustier-Kind&_sacat=0">eBay</a></li> <li><a href="https://www.amazon.com/s?k=itag+tracker+4.0">Amazon.com</a></li> </ul> <p><img src=../_media/bluetooth/itag.png width=225><img src=../_media/bluetooth/itag2.png width=225><img src=../_media/bluetooth/itag3.png width=225></p> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>You can activate a beacon with a beeper using command <code>IBEACON_%BEACONID%_RSSI 99</code> (ID is visible in webUI and SENSOR reports). This command can freeze the Bluetooth module and beacon scanning will stop. After a reboot of Tasmota the beacon will start beeping and scanning will resume. (untested on ESP32 native BLE) </p> </div> <blockquote> <blockquote> <blockquote> <blockquote> <blockquote> <blockquote> <blockquote> <p>development</p> </blockquote> </blockquote> </blockquote> </blockquote> </blockquote> </blockquote> </blockquote> <p>A preliminary EQ3 driver is in production. <a href=../EQ3-TRV/ >Documentation</a>. </p> <h3 id=commands_2>Commands<a class=headerlink href=#commands_2 title="Permanent link">~</a></h3> <p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD Full list of available <a href=../Commands/#ble-esp32>BLE ESP32 commands</a>.</p> <h4 id=setup-a-rule-to-set-some-aliases-at-boot-time>Setup a rule to set some aliases at boot time<a class=headerlink href=#setup-a-rule-to-set-some-aliases-at-boot-time title="Permanent link">~</a></h4> <p>======= If you enable MQTT discovery (<a href=../Commands/#setoption19><code>SetOption19 1</code></a>), additional MQTT messages are send.</p> <p>Primarily, at teleperiod or MI32period, discovery messages are sent. These inform Home Assistant about the devices. Device names can be dependent upon BLEAlias, so set <code>BLEAlias</code> at boot.</p> <blockquote> <blockquote> <blockquote> <blockquote> <blockquote> <blockquote> <blockquote> <p>development</p> </blockquote> </blockquote> </blockquote> </blockquote> </blockquote> </blockquote> </blockquote> <div class=highlight><pre><span></span><code><span class=kt>Backlog</span> <span class=kt>Rule1</span> <span class=kt>ON</span> <span class=kt>System</span><span class=o>#</span><span class=kt>Boot</span> <span class=kt>DO</span> <span class=kt>BLEAlias</span> <span class=kt>A4C1386A1E24</span><span class=ow>=</span><span class=n>fred</span> <span class=kt>A4C1387FC1E1</span><span class=ow>=</span><span class=n>james</span> <span class=n>endon</span><span class=p>;</span> <span class=kt>Rule1</span> <span class=mi>1</span>
</code></pre></div> <h4 id=enable-static-random-mac-addresses-in-addition-to-public-mac-addresses>Enable static random mac addresses in addition to public mac addresses<a class=headerlink href=#enable-static-random-mac-addresses-in-addition-to-public-mac-addresses title="Permanent link">~</a></h4> <p>If you have a device which does not appear, it may be advertising on a 'static random' address. Using this command may make it appear, but will also make other devices appear that you may not wish to see... For example phones advertising Covid messages. To know more, google 'BLE static random'. Be aware you can set 2 or 3....</p> <p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD <code>BLEAddrFilter 1</code> =======</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The topic would be the <strong>same</strong> from all Tasmotas if they have the same BLEAlias or no BLEAlias. So if you wish to 'hear' the same device separately from different Tasmotas, use different BLEAlias names. </p> </div> <blockquote> <blockquote> <blockquote> <blockquote> <blockquote> <blockquote> <blockquote> <p>development</p> </blockquote> </blockquote> </blockquote> </blockquote> </blockquote> </blockquote> </blockquote> <h4 id=check-the-interval-between-ble-tele-messages>Check the interval between BLE tele messages<a class=headerlink href=#check-the-interval-between-ble-tele-messages title="Permanent link">~</a></h4> <p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD <code>BLEPeriod</code></p> <p>=======</p> <h3 id=eq3-trv_1>EQ3 TRV<a class=headerlink href=#eq3-trv_1 title="Permanent link">~</a></h3> <p>A preliminary EQ3 driver is in production. <a href=../EQ3-TRV/ >Documentation</a>. </p> <h3 id=commands_3>Commands<a class=headerlink href=#commands_3 title="Permanent link">~</a></h3> <p>Full list of available <a href=../Commands/#ble-esp32>BLE ESP32 commands</a>.</p> <h4 id=setup-a-rule-to-set-some-aliases-at-boot-time_1>Setup a rule to set some aliases at boot time<a class=headerlink href=#setup-a-rule-to-set-some-aliases-at-boot-time_1 title="Permanent link">~</a></h4> <div class=highlight><pre><span></span><code><span class=kt>Backlog</span> <span class=kt>Rule1</span> <span class=kt>ON</span> <span class=kt>System</span><span class=o>#</span><span class=kt>Boot</span> <span class=kt>DO</span> <span class=kt>BLEAlias</span> <span class=kt>A4C1386A1E24</span><span class=ow>=</span><span class=n>fred</span> <span class=kt>A4C1387FC1E1</span><span class=ow>=</span><span class=n>james</span> <span class=n>endon</span><span class=p>;</span> <span class=kt>Rule1</span> <span class=mi>1</span>
</code></pre></div> <h4 id=enable-static-random-mac-addresses-in-addition-to-public-mac-addresses_1>Enable static random mac addresses in addition to public mac addresses<a class=headerlink href=#enable-static-random-mac-addresses-in-addition-to-public-mac-addresses_1 title="Permanent link">~</a></h4> <p><code>BLEAddrFilter 1</code></p> <h4 id=check-the-interval-between-ble-tele-messages_1>Check the interval between BLE tele messages<a class=headerlink href=#check-the-interval-between-ble-tele-messages_1 title="Permanent link">~</a></h4> <p><code>BLEPeriod</code></p> <blockquote> <blockquote> <blockquote> <blockquote> <blockquote> <blockquote> <blockquote> <p>development Set it to 40s: <code>BLEPeriod 40</code></p> </blockquote> </blockquote> </blockquote> </blockquote> </blockquote> </blockquote> </blockquote> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top data-md-state=hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../Berry/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Berry Scripting Language :material-cpu-32-bit:" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Berry Scripting Language :material-cpu-32-bit: </div> </div> </a> <a href=../TouchPin/ class="md-footer__link md-footer__link--next" aria-label="Next: Touch GPIOs" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Touch GPIOs </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://discord.gg/Ks2Kzd4 target=_blank rel=noopener title=discord.gg class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485.065 485.065 0 0 0 404.081 32.03a1.816 1.816 0 0 0-1.923.91 337.461 337.461 0 0 0-14.9 30.6 447.848 447.848 0 0 0-134.426 0 309.541 309.541 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.689 483.689 0 0 0-119.688 37.107 1.712 1.712 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.016 2.016 0 0 0 .765 1.375 487.666 487.666 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348.2 348.2 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321.173 321.173 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251.047 251.047 0 0 0 9.109-7.137 1.819 1.819 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.812 1.812 0 0 1 1.924.233 234.533 234.533 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.407 301.407 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391.055 391.055 0 0 0 30.014 48.815 1.864 1.864 0 0 0 2.063.7A486.048 486.048 0 0 0 610.7 405.729a1.882 1.882 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541zM222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241zm195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241z"/></svg> </a> <a href=https://t.me/tasmota target=_blank rel=noopener title=t.me class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm121.8 169.9-40.7 191.8c-3 13.6-11.1 16.9-22.4 10.5l-62-45.7-29.9 28.8c-3.3 3.3-6.1 6.1-12.5 6.1l4.4-63.1 114.9-103.8c5-4.4-1.1-6.9-7.7-2.5l-142 89.4-61.2-19.1c-13.3-4.2-13.6-13.3 2.8-19.7l239.1-92.2c11.1-4 20.8 2.7 17.2 19.5z"/></svg> </a> <a href=https://github.com/tasmota target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.instant", "navigation.top", "navigation.tracking"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.8397ff9e.min.js", "version": null}</script> <script src=../assets/javascripts/bundle.1e84347e.min.js></script> </body> </html>